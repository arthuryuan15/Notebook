# Maven

## 1 Maven Intro

**Maven** is a powerful project management tool that is based on POM (`project object model`). It is **used** for projects build, dependency and documentation.

### 1.1 function

1. Maven builds a project using its project object model (POM) and a set of plugins.
2. Integrated development
3. unit test

## 2 maven install

`brew install maven` on mac

`mvn -v` if this command doesn't work, go to next part

`vi ~/.bash_profile`

After that, paste the below paths in the base profile file and save it

```shell
export JAVA_HOME=/Users/yuanjinshuai/Tools/jdk1.8.0_211.jdk/Contents/Home
export M2_HOME=/Users/yuanjinshuai/Tools/apache-maven-3.8.1
export  PATH=${PATH}:${JAVA_HOME}/bin:${M2_HOME}/bin
```

* What is m2_home ?

  **M2_HOME** is **used** by Maven, and again it tells the program where to find Maven installation. PATH

* What is java_home ?

  JAVA_HOME is **used** by many Java-based applications to define the place of Java Runtime Environment (JRE) installation.

  

## 3 Maven Central Repository

![image-20210612164957686](/Users/yuanjinshuai/Library/Application Support/typora-user-images/image-20210612164957686.png)



## 4 maven standard directory layout

### 4.1 tranditional directory layout

* configuration file
* test file
* configuration for test

### 4.2 maven standard directory layout

<img src="https://p.ipic.vip/a9777v.jpg" alt="image-20210612170622117" style="zoom: 25%;" />

​    	src/mian/java `core code`

​		src/mian/resources `configure file`

​		src/test/java目录      `test file`

​		src/test/resources	`configure for test`

​		src/main/webapp	`web resoure`js，css，pic...

## 5 maven command

​	`mvn-clean` Clean up after the build.

​	`mvn-complie` Compiles Java sources.

​	`mvn-deploy` Deploy the built artifact to the remote repository.



## 6 maven Lifecycle

**five default lifecycle**

`complie`   `test`   `packgae`  ` install`   `deploy` 

`clean`: the `clean` lifecycle handles project cleaning, while the `site` lifecycle handles the creation of your project's site documentation.



## 7 pom file component

* What is pom?
       Pom is used as the project object model. The maven project is represented by xml and implemented using pom.xml. Mainly describes the project: including configuration files; rules that developers need to follow, defect management systems, organization and licenses, project urls, project dependencies, and all other project-related factors.

* Fundamental contents

  ​	The POM includes all project information.

  ​	Pom defines the smallest maven2 element, allowing groupId, artifactId, version.
  * groupId: The unique identifier of the project or organization, and the path generated during configuration is also generated from this. For example, the relative path generated by org.codehaus.mojo is: /org/codehaus/mojo
  
  * artifactId: the generic name of the project
  
  * Version: the version of the project
  
  * Packaging: packaging mechanisms such as pom, jar, maven-plugin, ejb, war, ear, rar, par
  
  * Classifier: classification
  
    

```xml
<project xmlns="http://maven.apache.org/POM/4.0.0"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
   <modelVersion>4.0.0</modelVersion>
   <!-- 1. groupId: groupId: The unique identifier of the project or organization, and the path generated during configuration is also generated from this. The relative path generated by com.mycompany.app is: /com/mycompany/app -->
   <groupId>asia.banseon</groupId>
  
   <!-- 2. artifactId: The generic name of the project -->
   <artifactId>banseon-maven2</artifactId>
  
   <!-- 3. packaging: packaging mechanism, such as pom, jar, maven-plugin, ejb, war, -->
   <packaging>jar</packaging>
  
   <!-- 4. version: version of the project -->
   <version>1.0-SNAPSHOT</version>
   
   <!-- 5. The name of the project, the documentation generated by Maven -->
   <name>banseon-maven</name>
  
   <!-- 6. Which website can find this project, suggesting that if the Maven resource list is not available, you can go directly to the website to find the documents generated by Maven -->
   <url>http://www.baidu.com/banseon</url>
  
   <!-- 7. Description of the project, the documentation generated by Maven -->
   <description>A maven project to study maven.</description>
   
   <!-- 8. Developer Information -->
   <developers>
       <developer>
           <id>HELLO WORLD</id>
           <name>banseon</name>
           <email>banseon@126.com</email>
           <roles>
               <role>Project Manager</role>
               <role>Architect</role>
           </roles>
           <organization>demo</organization>
           <organizationUrl>http://hi.baidu.com/banseon</organizationUrl>
           <properties>
               <dept>No</dept>
           </properties>
           <timezone>-5</timezone>
       </developer>
   </developers>
   
  <!-- 9. Similar developers -->
   <contributors></contributors>
  
   <!-- 10. mail list related to this project, used for subscription and other information -->
   <mailingLists>
       <mailingList>
           <name>Demo</name>
           <!-- Link mail -->
           <post>banseon@126.com</post>
           <!-- mail for subscribe the project -->
           <subscribe>banseon@126.com</subscribe>
           <!-- mail for unsubscribe the project -->
           <unsubscribe>banseon@126.com</unsubscribe>
           <archive>
           http:/hi.baidu.com/banseon/demo/dev/
           </archive>
       </mailingList>
   </mailingLists>
   
    <!-- 11. The name and URL of the project's problem management system (Bugzilla, Jira, Scarab, or any problem management system you like), in this case jira -->
   <issueManagement>
       <system>jira</system>
       <url>http://jira.baidu.com/banseon</url>
   </issueManagement>
  
   <!-- 12. organization information -->
   <organization>
       <name>demo</name>
       <url>http://www.baidu.com/banseon</url>
   </organization>

  <!-- 13. License -->
   <licenses>
       <license>
           <name>Apache 2</name>
           <url>http://www.baidu.com/banseon/LICENSE-2.0.txt</url>
           <distribution>repo</distribution>
           <comments>A business-friendly OSS license</comments>
       </license>
   </licenses>

  <!-- 14. The scm (software configuration management) tag allows you to configure your codebase for use by Maven web sites and other plugins.
		- If you are using CVS or Subversion, the source repository page can also give detailed, tool-specific instructions on how to use the codebase.
    - Below is a typical SCM configuration example
   -->
   <scm>
       <!-- The corresponding resource of the project on svn -->
       <connection>
           scm:svn:http://svn.baidu.com/banseon/maven/banseon/banseon-maven2-trunk(dao-trunk)
       </connection>
       <developerConnection>
           scm:svn:http://svn.baidu.com/banseon/maven/banseon/dao-trunk
       </developerConnection>
       <url>http://svn.baidu.com/banseon</url>
   </scm>
 
  
   <!-- 15. Used to configure distribution management, configure the corresponding product release information, mainly used for publishing, indicating the location to be published after executing mvn deploy -->
   <distributionManagement>
               <!-- Configure to file system -->
       <repository>
           <id>banseon-maven2</id>
           <name>banseon maven2</name>
           <url>file://${basedir}/target/deploy</url>
       </repository>
               <!-- Use ssh2 configuration -->
       <snapshotRepository>
           <id>banseon-maven2</id>
           <name>Banseon-maven2 Snapshot Repository</name>
           <url>scp://svn.baidu.com/banseon:/usr/local/maven-snapshot</url>
       </snapshotRepository>
               <!-- Use ssh2 configuration -->
       <site>
           <id>banseon-site</id>
           <name>business api website</name>
           <url>
               scp://svn.baidu.com/banseon:/var/www/localhost/banseon-web
           </url>
       </site>
   </distributionManagement>
  
   <!-- 16. Dependencies -->
   <dependencies>
       <dependency>
           <groupId>junit</groupId>
           <artifactId>junit</artifactId>
           <version>3.8.1</version>
           <scope>test</scope>
       </dependency>
       <dependency>
           <groupId>org.acegisecurity</groupId>
           <artifactId>acegi-security</artifactId>
           <version>1.0.5</version>
           <scope>runtime</scope>
           <exclusions>
               <exclusion>
                   <artifactId>spring-remoting</artifactId>
                   <groupId>org.springframework</groupId>
               </exclusion>
           </exclusions>
       </dependency>
   </dependencies>
   <!-- 17. maven proxy, local repository, replace the maven.apache.org website jar list, when the user downloads, first look for the site
		- Download if the resource is found. Otherwise go to the jar list site. For multi-person teams, you can save download speed and personal storage space.
   -->
   <repositories>
       <repository>
           <id>banseon-repository-proxy</id>
           <name>banseon-repository-proxy</name>
           <url>http://192.168.1.169:9999/repository/</url>
           <layout>default</layout>
       </repository>
   </repositories>
<project>
```



## 8 idea integrate dmaven

1. setting-maven

   maven home dir : D:\my_java\apache-maven-3.5.2

   User settings file: D:\my_java\apache-maven-3.5.2\conf\setting.xml

2. setting-maven-Runner

   VM opt: -DarchetypeCatalog=internal



## 9  use idea archetype to maven

1. maven-archetype-quickstart -- > only pom.xml
2. maven-archetype-webapp 

### 9.1 single module in a project

after that you need to add some tag in pomx.ml

1. add modules

   ```xml
   <modules>
     <module>weishi-course-server</module>
     <module>weishi-course-api</module>
     <module>weishi-course-client-starter</module>
   </modules>
   ```

2. add version variable 

   ```xml
   <properties>
     <java.version>1.8</java.version>
   </properties>
   ```

3. add dependecy

   ```xml
   <dependencies>
     <dependency>
       <groupId>org.springframework.boot</groupId>
       <artifactId>spring-boot-starter-web</artifactId>
     </dependency>
   </dependencies>
   ```

4. add pulgins 

   ```xml
   <build>
     <plugins>
       <plugin>
         <groupId>org.apache.maven.plugins</groupId>
         <artifactId>maven-compiler-plugin</artifactId>
         <version>3.5.1</version>
         <configuration>
           <compilerVersion>1.8</compilerVersion>
           <source>1.8</source>
           <target>1.8</target>
           <encoding>UTF-8</encoding>
         </configuration>
       </plugin>
     </plugins>
   </build>
   ```



### 9.2 multi-module in a project

1. for the parent pom.xml , make package as pom `<packaging>pom</packaging>` 

2. for the other you need to modules both need dependencies and be dependencied make package as pom `<packaging>pom</packaging>`

3. add dependencies in module need to be dependencied

   ```xml
   <dependency>
       <groupId>com.arthuryuan</groupId>
       <artifactId>mysite-common</artifactId>
       <version>0.0.1-SNAPSHOT</version>
   </dependency>
   ```

4. also add  dependencies in module offers dependency

   ```xml
   <dependency>
     <groupId>com.arthuryuan</groupId>
     <artifactId>mysite-pc</artifactId>
     <version>0.0.1-SNAPSHOT</version>
   </dependency>
   ```

   

## 10 settings.xml

1. configure local repository

```xml
	<localRepository>/Users/yuanjinshuai/.m2/repository</localRepository>
```

2. configure private repository

```xml
		<profile>
			<id>dev</id>
			<repositories>
				<repository>
					<id>nexus</id>
					<url>http://nexus.hepengju.cn:8081/nexus/content/groups/public/</url>
					<releases>
						<enabled>true</enabled>
					</releases>
					<snapshots>
						<enabled>true</enabled>
					</snapshots>
				</repository>
			</repositories>
			<pluginRepositories>
				<pluginRepository>
					<id>public</id>
					<name>Public Repositories</name>
					<url>http://nexus.hepengju.cn:8081/nexus/content/groups/public/</url>
				</pluginRepository>
			</pluginRepositories>
		</profile>
```

3. configure remote repository

```xml
		<mirror>
			<id>aliyunmaven</id>
			<mirrorOf>central</mirrorOf>
			<name>aliyun maven</name>
			<url>https://maven.aliyun.com/repository/public </url>
		</mirror>
```



# POM

https://maven.apache.org/guides/introduction/introduction-to-the-pom.html

